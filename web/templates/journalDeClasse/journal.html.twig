{% extends 'base.html.twig' %}

{% block title %} -Journal de classe {% endblock %}

{% block header %}
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="/CSS/scripts/editable.css">
{% endblock %}

{% block scripts %}
    <script src="/JS/scripts/editable.js"></script>
    <script src="/JS/main.js"></script>
    <script>
        $(document).ready(function(){
            $('#tableJournal span').editable();
            $('#tablePeriode span').editable();
        });
    </script>
{% endblock %}
{% block container %}

<div class="jumbotron" style="font-size: 1.3em;">
    <h3 class="display-7" style="text-align: center">Journal de classe</h1>
    <h5 class="display-10" style="text-align: center">{{ecole.0.ecole.nomEcole}}</h3>

    <div class="row d-flex justify-content-center">
        <a href="{{path('new_cours', {idGroup: ecole.0.groups.id})}}" style="margin-right:10px;" class="btn btn-primary btn-md" style="text-align: center">Nouveau cours</a>
        <a href="{{path('new_evaluation', {idGroup: ecole.0.groups.id})}}" style="margin-right:10px;" class="btn btn-primary btn-md" style="text-align: center">Nouvelle évaluation</a>
        <a href="#" class="btn btn-primary btn-md" style="text-align: center">Plannification de cycle</a>
    </div>
    <br>
    <div class="table-responsive">
        <table class="table" id="tableJournal">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Nom</th>
                    <th>Prenom</th>
                    <th>Classe</th>
                    {% for key, value in eleves.0.0.0.coursGroupes|sort((a, b) => a.coursId.dateCours <=> b.coursId.dateCours) %}                           
                        {% set dateCours = date(value.coursId.dateCours.date) %}
                        <td colspan="2" class="text-center">
                            <span  data-pk="{{value.coursId.id}}" data-url="{{path('modif_intitule')}}" data-name="intitule"> {{value.coursId.intitule}} </span> 
                            <p>
                                <span data-pk="{{value.coursId.id}}" data-url="{{path('modif_date')}}" data-name="cours"> {{dateCours | date('d-m-Y')}}</span>
                            </p>
                            <small>Heures: </small>
                            <p>
                                <span data-pk="{{value.coursId.id}}" data-url="{{path('modif_heures')}}" data-name="heures">{{value.coursId.nombreHeures}}</span>
                            </p>
                        </td>
                    {% endfor %}
                </tr>
            </thead>
            <tbody> 
                {% for key, value in eleves %}
                    <tr>
                        <td id="nombreEleve">{{loop.index}}</td>
                        {% for key, val in value %}
                            <td id="nom">{{val.nom}}</td>
                            <td id="prenom">{{val.prenom}}</td>
                            <td>{{val.classe.nomClasse}}</td>       
                            {% for key, value in val.coursGroupes|sort((a, b) => a.coursId.dateCours <=> b.coursId.dateCours) %}
                                <td>
                                    <select name="presence" id="presence" onchange="presenceEleve(this)" class="custom-select mr-sm-5">
                                        {% if value.presences.id != 1 %}
                                            <option value="{{value.coursId.id}},{{val.id}},{{value.presences.id}}" selected>{{value.presences.abreviation}}</option>
                                        {% endif %}
                                        {% for key, presence in presences %}
                                            <option value="{{value.coursId.id}},{{val.id}},{{presence.id}}">{{presence.abreviation}}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <span data-pk="{{value.coursId.id}}" data-url="{{path('modif_points')}}" data-name="{{val.id}}">{{value.points}}</span>
                                </td>
                            {% endfor %}
                        {% endfor %}
                    </tr>
                {% endfor %}                   
            </tbody>
        </table>
    </div>      
</div>
<div class="jumbotron my-4">
    <h5 class="display-7" style="text-align: center">Changez le groupe: </h3>
    <div class="row d-flex justify-content-center">
        <select name="groups" id="groups" class="custom-select col-md-6" onchange="window.location.href=this.value">
            <option value="#"></option>
            {% for key, value in groups %}
                <optgroup label="{{value.ecole}}">
                    <option value="{{path('journal_de_classe', {idGroup: value.groups_id})}}">{{value.groupes}}</option>
                </optgroup>
            {% endfor %}
        </select>
    </div>
</div>
<div class="jumbotron" style="font-size: 1.3em;">
    <h3 class="display-7" style="text-align: center">Pourcentage d'évaluation</h3>
    {% for message in app.flashes('error') %}
        <div class="alert alert-danger">
            {{ message }}
        </div>
    {% endfor %}
    <div class="row d-flex justify-content-center">        
        <a href="{{path('new_periode', {idGroup: eleves.0.0.0.classe.groups.id})}}">Ajouter les périodes</a>
        <table class="table" id="tablePeriode">
            <thead>
                <tr>
                    {% for key, value in periodes %}
                        <th>{{value.nomPeriode}}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                <tr>
                    {% for key, value in periodes %}
                        <td>
                            <span data-pk="{{value.id}}" data-url="{{path('modif_periode')}}" data-name="periode"> {{value.pourcentage}} </span>%
                        </td>
                    {% endfor %}
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}